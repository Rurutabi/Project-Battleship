(()=>{"use strict";class e{constructor(e){this.shipLength=e>=0?e:-1}hits(){this.shipLength=this.shipLength-1,this.isSunk()}isSunk(){0===this.shipLength&&(this.shipLength="sunken ship")}}class t{constructor(e){this.player=e}}new class{subMarine=new e(2);destroyer=new e(3);battleShip=new e(4);cruiser=new e(5);aircraftCarrier=new e(6);draggedShipElement=null;player=new t(!0);ai=new t(!1);recordShipCreate=[];recordShipLocation=[];constructor(e,t){this.playerBoard=this.createArrayboard(e),this.aiBoard=this.createArrayboard(t),this.createBoard(),this.createShip(),this.dragShip(),this.placeAiShip(),this.handleTurnClick()}createArrayboard(e){return Array.from({length:e},(()=>Array.from({length:e},(()=>0))))}handleTurnClick(){const e=document.querySelectorAll(".ai-cell"),t=document.querySelectorAll(".player-cell"),a=new Set;e.forEach(((e,i)=>{e.addEventListener("click",(()=>{if(!e.classList.contains("aquamarine")&&!e.classList.contains("red")){let r;this.receiveAttack(i,this.aiBoard),e.classList.add("aquamarine");do{r=Math.floor(100*Math.random())}while(a.has(r)&&a.size<100);a.add(r);const s=this.getRow(r),o=this.getCol(r);0===this.playerBoard[s][o]?t[r].classList.add("aquamarine"):t[r].classList.add("red"),this.receiveAttack(r,this.playerBoard)}}))}))}createBoard(){const e=document.createElement("div");e.classList.add("container"),document.body.appendChild(e);const t=document.createElement("div");t.classList.add("board-container","player-board"),e.appendChild(t);const a=document.createElement("div");a.classList.add("board-container","ai-board"),e.appendChild(a),a.classList.add("hide"),this.populateBoard(t),this.populateBoard(a)}populateBoard(e){for(let t=0;t<10;t++)for(let t=0;t<10;t++){const t=document.createElement("div");t.classList.add("cell"),e.classList.contains("player-board")?t.classList.add("player-cell"):t.classList.add("ai-cell"),e.appendChild(t)}}createShip(){const e=document.querySelector(".container"),t=document.createElement("div");t.classList.add("shiplist-container"),e.appendChild(t),this.populateShip(this.subMarine,t),this.populateShip(this.destroyer,t),this.populateShip(this.aircraftCarrier,t),this.populateShip(this.cruiser,t),this.populateShip(this.battleShip,t)}populateShip(e,t){const a=document.createElement("div");a.classList.add("ship-container"),a.setAttribute("id",`ship${e.shipLength}-container`),a.style.gridTemplateColumns=`repeat(${e.shipLength}, 50px)`,t.appendChild(a),a.draggable=!0;for(let t=0;t<e.shipLength;t++){const t=document.createElement("div");t.classList.add("ship-cell"),this.colorFromLength(e.shipLength,t),t.setAttribute("id",`${e.shipLength}`),a.appendChild(t)}this.recordShipCreate.push(e)}dragShip(){const e=document.querySelectorAll(".player-cell"),t=document.querySelector(".shiplist-container"),a=document.querySelectorAll(".ship-container"),i=document.querySelector(".ai-board");a.forEach((e=>{e.addEventListener("dragstart",(t=>{t.dataTransfer.setData("text/shipContainerID",e.id),t.dataTransfer.setData("text/shipCellRelativePos",t.offsetX)}))})),e.forEach(((a,r)=>{a.addEventListener("dragover",(e=>{e.preventDefault()})),a.addEventListener("drop",(a=>{const s=a.dataTransfer.getData("text/shipContainerID"),o=document.getElementById(s),l=o.querySelectorAll(".ship-cell"),h=parseInt(a.dataTransfer.getData("text/shipCellRelativePos"),10),n=Math.floor(h/50),d=r-n,c=d+l.length,p=c-d,u=this.getRow(d);if(u===(c%10==0?this.getRow(c-1):this.getRow(c))&&this.isCellPlaced(e,d,c)){for(let t=d;t<d+l.length;t++)e[t].classList.add("placed"),this.colorFromLength(p,e[t]),o.remove();for(let e=0;e<this.recordShipCreate.length;e++)this.recordShipCreate[e].shipLength===l.length&&this.placePlayerShip(d,this.recordShipCreate[e])}u&&0===t.childElementCount&&(t.remove(),i.classList.remove("hide"))}))}))}placePlayerShip(e,t){if(e<0||null===e)return"Index cant be negative number or null";let a=this.getRow(e),i=this.getCol(e);if(a>this.playerBoard.length)return"Index is larger than the board";if(!(i+t.shipLength<=this.playerBoard.length))return"out of bound";for(let r=0;r<t.shipLength;r++)this.playerBoard[a][i]=t.shipLength,i<=10?(this.recordShipLocation.push({shipLocation:e,ship:t}),e++,i++):(a++,i=0)}placeAiShip(){let e;e=Math.floor(100*Math.random())}receiveAttack(e,t){let a=this.getRow(e),i=this.getCol(e);if(-1===t[a][i])return"Shot at the same locaiton";for(let t=0;t<this.recordShipLocation.length;t++)e===this.recordShipLocation[t].shipLocation&&this.recordShipLocation[t].ship.hits();t[a][i]=-1}isCellPlaced(e,t,a){for(let i=t;i<a;i++)if(e[i].classList.contains("placed"))return!1;return!0}getRow(e){return e>=100?Math.floor(e/10)-10:Math.floor(e/10)}getCol(e){return e%10}isWithinBound(e,t){return e>-1&&e<11&&t>-1&&t<11}colorFromLength(e,t){2===e&&t.classList.add("midnightblue"),3===e&&t.classList.add("goldenrod"),4===e&&t.classList.add("darkviolet"),5===e&&t.classList.add("palevioletred"),6===e&&t.classList.add("chartreuse")}}(10,10)})();