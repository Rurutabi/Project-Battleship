(()=>{"use strict";class e{constructor(e){this.shipLength=e>=0?e:-1,this.shipCoordinate=[]}hits(){this.shipLength=this.shipLength-1,this.isSunk()}isSunk(){0===this.shipLength&&(this.shipLength="sunken ship")}}class t{constructor(e){this.player=e}}new class{subMarine=new e(2);destroyer=new e(3);battleShip=new e(4);cruiser=new e(5);aircraftCarrier=new e(6);draggedShipElement=null;player=new t(!0);ai=new t(!1);recordShipLocation=[];constructor(t,a){this.playerBoard=this.createArrayboard(t),this.aiBoard=this.createArrayboard(a),this.createBoard(),this.createShip(),this.dragShip(),this.playerTurn();const i=new e(4);this.placeShip(40,i),this.placeShip(58,this.subMarine),console.log(this.recordShipLocation),this.receiveAttack(45,this.playerBoard,i)}createArrayboard(e){return Array.from({length:e},(()=>Array.from({length:e},(()=>0))))}playerTurn(){const e=document.querySelectorAll(".ai-cell"),t=document.querySelectorAll(".player-cell"),a=new Set;e.forEach(((e,i)=>{e.addEventListener("click",(()=>{if(!e.classList.contains("red")){let r;this.receiveAttack(i,this.aiBoard),e.classList.add("red");do{r=Math.floor(100*Math.random())}while(a.has(r)&&a.size<100);a.add(r),this.receiveAttack(r,this.playerBoard),t[r].classList.add("red")}}))}))}createBoard(){const e=document.createElement("div");e.classList.add("container"),document.body.appendChild(e);const t=document.createElement("div");t.classList.add("board-container","player-board"),e.appendChild(t);const a=document.createElement("div");a.classList.add("board-container","ai-board"),e.appendChild(a),a.classList.add("hide"),this.populateBoard(t),this.populateBoard(a)}populateBoard(e){for(let t=0;t<10;t++)for(let t=0;t<10;t++){const t=document.createElement("div");t.classList.add("cell"),e.classList.contains("player-board")?t.classList.add("player-cell"):t.classList.add("ai-cell"),e.appendChild(t)}}createShip(){const e=document.querySelector(".container"),t=document.createElement("div");t.classList.add("other-container"),e.appendChild(t),this.populateShip(this.subMarine.shipLength.length,t),this.populateShip(this.destroyer.shipLength.length,t),this.populateShip(this.aircraftCarrier.shipLength.length,t),this.populateShip(this.cruiser.shipLength.length,t),this.populateShip(this.battleShip.shipLength.length,t)}populateShip(e,t){const a=document.createElement("div");a.classList.add("ship-container"),a.setAttribute("id",`ship${e}-container`),a.style.gridTemplateColumns=`repeat(${e}, 50px)`,t.appendChild(a),a.draggable=!0;for(let t=0;t<e;t++){const t=document.createElement("div");t.classList.add("ship-cell"),this.colorFromLength(e,t),t.setAttribute("id",`${e}`),a.appendChild(t)}}dragShip(){const e=document.querySelectorAll(".player-cell");document.querySelectorAll(".ship-container").forEach((e=>{e.addEventListener("dragstart",(t=>{t.dataTransfer.setData("text/shipContainerID",e.id),t.dataTransfer.setData("text/shipCellRelativePos",t.offsetX)}))})),e.forEach(((t,a)=>{t.addEventListener("dragover",(e=>{e.preventDefault()})),t.addEventListener("drop",(t=>{const i=t.dataTransfer.getData("text/shipContainerID"),r=document.getElementById(i),s=r.querySelectorAll(".ship-cell"),n=parseInt(t.dataTransfer.getData("text/shipCellRelativePos"),10),o=Math.floor(n/50),l=a-o,h=l+s.length,d=h-l;if(this.getRow(l)===(h%10==0?this.getRow(h-1):this.getRow(h))&&!0===this.isCellPlaced(e,l,h))for(let t=l;t<l+s.length;t++)e[t].classList.add("placed"),this.colorFromLength(d,e[t]),r.remove()}))}))}isCellPlaced(e,t,a){for(let i=t;i<a;i++)if(e[i].classList.contains("placed"))return!1;return!0}placeShip(e,t){if(e<0||null===e)return"Index cant be negative number or null";let a=this.getRow(e),i=this.getCol(e);if(a>this.playerBoard.length)return"Index is larger than the board";if(!(i+t.shipLength<=this.playerBoard.length))return"out of bound";for(let r=0;r<t.shipLength;r++)this.playerBoard[a][i]=t.shipLength,i<=10?(this.recordShipLocation.push({shipLocation:e,shipLength:t.shipLength}),e++,i++):(a++,i=0)}receiveAttack(e,t,a){let i=this.getRow(e),r=this.getCol(e);for(let e=0;e<this.recordShipLocation.length;e++)this.recordShipLocation[e].shipLocation;t[i][r]=-1}getRow(e){return e>=100?Math.floor(e/10)-10:Math.floor(e/10)}getCol(e){return e%10}isWithinBound(e,t){return e>-1&&e<11&&t>-1&&t<11}colorFromLength(e,t){2===e&&t.classList.add("Midnightblue"),3===e&&t.classList.add("Brown"),4===e&&t.classList.add("Cadetblue"),5===e&&t.classList.add("Palevioletred"),6===e&&t.classList.add("Crimson")}getShipCoordinate(e,t){return e.shipCoordinate.indexOf(t)}}(10,10)})();