(()=>{"use strict";class e{constructor(e){this.shipLength=e>=0?e:-1}hits(){this.shipLength-=1,this.isSunk()}isSunk(){0===this.shipLength&&(this.shipLength="sunken ship")}}new class{playerSubmarine=new e(2);playerDestoryer=new e(3);playerBattleShip=new e(4);playerCruiser=new e(5);playerAircraftCarrier=new e(6);aiSubmarine=new e(2);aiDestoryer=new e(3);aiBattleShip=new e(4);aiCruiser=new e(5);aiAircraftCarrier=new e(6);recordPlayerShip=[];recordPlayerShipLocation=[];recordAiShip=[];recordAiShipLocation=[];recordfirstAiAttack=[];otherAiAttack=[];recordAttackedShip=[];right=!0;left=!1;checkWinner=!1;shipCounting=5;constructor(e,t){this.playerBoard=this.createArrayboard(e),this.aiBoard=this.createArrayboard(t),this.createUI(),this.createShip(),this.dragShip(),this.handleTurnClick(),this.restartGame()}restartGame(){const e=document.querySelector(".restart-button"),t=document.querySelector(".restart-container"),i=document.querySelector(".overlay"),r=document.querySelectorAll(".ai-cell"),s=document.querySelectorAll(".player-cell"),a=document.querySelector(".ai-board"),h=document.querySelector(".shiplist-container"),o=document.querySelectorAll(".ship-container");e.addEventListener("click",(()=>{h.style.display="flex",t.style.display="none",i.classList.add("hide"),this.resetBoard(this.playerBoard),this.resetBoard(this.aiBoard),this.resetCell(r),this.resetCell(s),this.playerSubmarine.shipLength=2,this.playerDestoryer.shipLength=3,this.playerBattleShip.shipLength=4,this.playerCruiser.shipLength=5,this.playerAircraftCarrier.shipLength=6,this.aiSubmarine.shipLength=2,this.aiDestoryer.shipLength=3,this.aiBattleShip.shipLength=4,this.aiCruiser.shipLength=5,this.aiAircraftCarrier.shipLength=6,this.recordPlayerShipLocation=[],this.recordAiShipLocation=[],this.recordfirstAiAttack=[],this.otherAiAttack=[],this.recordAttackedShip=[],this.right=!0,this.left=!1,a.classList.add("hide"),this.shipCounting=5,o.forEach((e=>{e.style.display="grid"})),this.checkWinner=!1,console.log(this.checkWinner)}))}resetCell=e=>{e.forEach((e=>{e.classList.remove("red"),e.classList.remove("aquamarine"),e.classList.remove("goldenrod"),e.classList.remove("darkviolet"),e.classList.remove("midnightblue"),e.classList.remove("palevioletred"),e.classList.remove("chartreuse"),e.classList.remove("placed")}))};resetBoard(e){e.forEach((e=>{for(let t=0;t<e.length;t+=1)e[t]=0}))}createArrayboard(e){return Array.from({length:e},(()=>Array.from({length:e},(()=>0))))}handleTurnClick(){const e=document.querySelectorAll(".ai-cell"),t=document.querySelectorAll(".player-cell"),i=document.querySelector(".restart-container"),r=document.querySelector(".overlay"),s=document.querySelector(".winner-text"),a=new Set;e.forEach(((e,h)=>{e.addEventListener("click",(()=>{if(!1===this.checkWinner&&!e.classList.contains("aquamarine")&&!e.classList.contains("red")){const o=this.getRow(h),l=this.getCol(h);let n;if(0===this.aiBoard[o][l]?e.classList.add("aquamarine"):e.classList.add("red"),this.receiveAttack(h,this.aiBoard,this.recordAiShipLocation),0===this.recordAttackedShip.length)do{n=Math.floor(100*Math.random())}while(a.has(n)&&a.size<100);else if("sunken ship"!==this.recordAttackedShip[0].shipLength)!0===this.right?(n=this.otherAiAttack.pop(),n+=1,a.has(n)&&(this.right=!1,this.left=!0,n=this.recordfirstAiAttack.pop(),n-=1),0===this.playerBoard[this.getRow(n)][this.getCol(n)]&&(this.right=!1,this.left=!0)):!0===this.left&&(n=this.recordfirstAiAttack.pop(),n-=1);else{this.recordAttackedShip.length=0,this.otherAiAttack.length=0,this.recordfirstAiAttack.length=0,this.right=!0,this.left=!1;do{n=Math.floor(100*Math.random())}while(a.has(n)&&a.size<100)}this.aiAimming(n,this.playerBoard),this.getCol(n)>=9&&0!==this.recordAttackedShip.length&&(this.right=!1,this.left=!0),a.add(n);const d=this.getRow(n),c=this.getCol(n);0===this.playerBoard[d][c]?t[n].classList.add("aquamarine"):t[n].classList.add("red"),this.receiveAttack(n,this.playerBoard,this.recordPlayerShipLocation),!0===this.playerWinCondition()?(i.classList.remove("hide"),r.classList.remove("hide"),i.style.display="flex",s.textContent="Player Win",this.checkWinner=!0):!0===this.aiWinCondition()&&(i.classList.remove("hide"),r.classList.remove("hide"),i.style.display="flex",s.textContent="Ai Win",this.checkWinner=!0)}}))}))}aiAimming(e,t){if(void 0===e)return;const i=this.getRow(e),r=this.getCol(e);if(0!==t[i][r]&&-1!==t[i][r]&&(this.otherAiAttack.length<1&&this.otherAiAttack.push(e),this.recordfirstAiAttack.length<1&&this.recordfirstAiAttack.push(e),this.recordAttackedShip.length<1))for(let e=0;e<this.recordPlayerShip.length;e+=1)this.playerBoard[i][r]===this.recordPlayerShip[e].shipLength&&this.recordAttackedShip.push(this.recordPlayerShip[e])}createUI(){const e=document.createElement("div");e.classList.add("container"),document.body.appendChild(e);const t=document.createElement("div");t.classList.add("header-container"),e.appendChild(t);const i=document.createElement("h1");i.classList.add("title"),i.textContent="BattleShip",t.appendChild(i);const r=document.createElement("div");r.classList.add("body-container"),e.appendChild(r);const s=document.createElement("div");s.classList.add("board-container","player-board"),r.appendChild(s);const a=document.createElement("div");a.classList.add("board-container","ai-board"),r.appendChild(a),a.classList.add("hide");const h=document.createElement("footer"),o=document.createElement("p");o.textContent="Create by Siraphop Sompamit",e.appendChild(h);const l=document.createElement("div");l.classList.add("restart-container"),l.classList.add("delay"),document.body.appendChild(l);const n=document.createElement("button");n.classList.add("restart-button"),n.textContent="Restart",l.appendChild(n);const d=document.createElement("div");d.classList.add("winner-text"),d.classList.add("delay");const c=document.createElement("div");c.classList.add("overlay"),c.classList.add("hide"),document.body.appendChild(c),l.appendChild(d),h.appendChild(o),this.populateBoard(s),this.populateBoard(a)}populateBoard=e=>{for(let t=0;t<10;t+=1)for(let t=0;t<10;t+=1){const t=document.createElement("div");t.classList.add("cell"),e.classList.contains("player-board")?t.classList.add("player-cell"):t.classList.add("ai-cell"),e.appendChild(t)}};createShip(){const e=document.querySelector(".body-container"),t=document.createElement("div");t.classList.add("shiplist-container"),e.appendChild(t),this.populateShip(this.playerSubmarine,t),this.populateShip(this.playerDestoryer,t),this.populateShip(this.playerAircraftCarrier,t),this.populateShip(this.playerCruiser,t),this.populateShip(this.playerBattleShip,t),this.recordAiShip.push(this.aiAircraftCarrier),this.recordAiShip.push(this.aiBattleShip),this.recordAiShip.push(this.aiCruiser),this.recordAiShip.push(this.aiDestoryer),this.recordAiShip.push(this.aiSubmarine)}populateShip(e,t){const i=document.createElement("div");i.classList.add("ship-container"),i.setAttribute("id",`ship${e.shipLength}-container`),i.style.gridTemplateColumns=`repeat(${e.shipLength}, 50px)`,t.appendChild(i),i.draggable=!0;for(let t=0;t<e.shipLength;t+=1){const t=document.createElement("div");t.classList.add("ship-cell"),this.colorFromLength(e.shipLength,t),t.setAttribute("id",`${e.shipLength}`),i.appendChild(t)}this.recordPlayerShip.push(e)}dragShip(){const e=document.querySelectorAll(".player-cell"),t=document.querySelectorAll(".ship-container"),i=document.querySelector(".shiplist-container"),r=document.querySelector(".ai-board");t.forEach((e=>{e.addEventListener("dragstart",(t=>{t.dataTransfer.setData("text/shipContainerID",e.id),t.dataTransfer.setData("text/shipCellRelativePos",t.offsetX)}))})),e.forEach(((t,s)=>{t.addEventListener("dragover",(e=>{e.preventDefault()})),t.addEventListener("drop",(t=>{const a=t.dataTransfer.getData("text/shipContainerID"),h=document.getElementById(a),o=h.querySelectorAll(".ship-cell"),l=parseInt(t.dataTransfer.getData("text/shipCellRelativePos"),10),n=Math.floor(l/50),d=s-n,c=this.getCol(d);if(!0===this.inSameRow(c,o.length,this.playerBoard)&&!0===this.isCellPlaced(d,o.length,this.playerBoard)){for(let t=d;t<d+o.length;t+=1)e[t].classList.add("placed"),this.colorFromLength(o.length,e[t]),h.style.display="none";let t,i;this.shipCounting-=1,console.log(d,o),this.pushShipLengthToArray(d,o,this.playerBoard,this.recordPlayerShip,this.recordPlayerShipLocation);do{t=Math.floor(100*Math.random()),i=this.getCol(t)}while(!1===this.inSameRow(i,o.length,this.aiBoard)||!1===this.isCellPlaced(t,o.length,this.aiBoard));this.pushShipLengthToArray(t,o,this.aiBoard,this.recordAiShip,this.recordAiShipLocation)}0===this.shipCounting&&(i.style.display="none",r.classList.remove("hide")),console.log(this.playerBoard)}))}))}pushShipLengthToArray(e,t,i,r,s){console.log(r),console.log(s);for(let a=0;a<r.length;a+=1)r[a].shipLength===t.length&&this.placeShip(e,r[a],i,s)}placeShip(e,t,i,r){if(e<0||null===e)return"Index cant be negative number or null";let s=this.getRow(e),a=this.getCol(e);if(s>i.length)return"Index is larger than the board";if(!0!==this.inSameRow(a,t.shipLength,i))return"out of bound";for(let h=0;h<t.shipLength;h+=1)i[s][a]=t.shipLength,a<=10?(r.push({shipLocation:e,ship:t}),e+=1,a+=1):(s+=1,a=0)}receiveAttack(e,t,i){const r=this.getRow(e),s=this.getCol(e);if(0===t[r][s]&&(t[r][s]=-1),0===t[r][s]||-1===t[r][s])return"Shot at the same locaiton";for(let t=0;t<i.length;t+=1)e===i[t].shipLocation&&i[t].ship.hits();t[r][s]=-1}isAllShipsSunk(e){return e.every((e=>"sunken ship"===e.shipLength))}playerWinCondition(){return this.isAllShipsSunk(this.recordAiShip)}aiWinCondition(){return this.isAllShipsSunk(this.recordPlayerShip)}inSameRow(e,t,i){return e+t<=i.length}isCellPlaced(e,t,i){const r=this.getRow(e),s=this.getCol(e);for(let e=s;e<s+t;e+=1)if(0!==i[r][e])return!1;return!0}getRow(e){return e>=100?Math.floor(e/10)-10:Math.floor(e/10)}getCol(e){return e%10}colorFromLength(e,t){2===e&&t.classList.add("midnightblue"),3===e&&t.classList.add("goldenrod"),4===e&&t.classList.add("darkviolet"),5===e&&t.classList.add("palevioletred"),6===e&&t.classList.add("chartreuse")}}(10,10)})();