(()=>{"use strict";class t{constructor(t){this.shipLength=t>=0?t:-1}hits(){this.shipLength=this.shipLength-1,this.isSunk()}isSunk(){0===this.shipLength&&(this.shipLength="sunken ship")}}new class{playerSubmarine=new t(2);playerDestoryer=new t(3);playerBattleShip=new t(4);playerCruiser=new t(5);playerAircraftCarrier=new t(6);aiSubmarine=new t(2);aiDestoryer=new t(3);aiBattleShip=new t(4);aiCruiser=new t(5);aiAircraftCarrier=new t(6);recordPlayerShip=[];recordPlayerShipLocation=[];recordAiShip=[];recordAiShipLocation=[];recordfirstAiAttack=[];otherAiAttack=[];recordAttackedShip=[];right=!0;left=!1;constructor(t,e){this.playerBoard=this.createArrayboard(t),this.aiBoard=this.createArrayboard(e),this.createUI(),this.createShip(),this.dragShip(),this.handleTurnClick(),console.log(this.recordPlayerShip)}createArrayboard(t){return Array.from({length:t},(()=>Array.from({length:t},(()=>0))))}handleTurnClick(){const t=document.querySelectorAll(".ai-cell"),e=document.querySelectorAll(".player-cell"),i=new Set;let r=!1;t.forEach(((t,a)=>{t.addEventListener("click",(()=>{if(!1===r&&!t.classList.contains("aquamarine")&&!t.classList.contains("red")){const s=this.getRow(a),h=this.getCol(a);let o;if(0===this.aiBoard[s][h]?t.classList.add("aquamarine"):t.classList.add("red"),this.receiveAttack(a,this.aiBoard,this.recordAiShipLocation),0===this.recordAttackedShip.length)do{o=Math.floor(100*Math.random())}while(i.has(o)&&i.size<100);else!0===this.right?(o=this.otherAiAttack.pop(),o++,0===this.playerBoard[this.getRow(o)][this.getCol(o)]&&(this.otherAiAttack.push(this.recordfirstAiAttack[0]),this.right=!1,this.left=!0)):!0===this.left&&(console.log(this.recordAttackedShip),"sunken ship"!==this.recordAttackedShip[0].shipLength?(o=this.otherAiAttack.pop(),o--):(this.recordAttackedShip=[],this.otherAiAttack=[],this.recordfirstAiAttack=[],this.right=!0,this.left=!1));this.aiAimming(o,this.playerBoard),i.add(o);const l=this.getRow(o),n=this.getCol(o);0===this.playerBoard[l][n]?e[o].classList.add("aquamarine"):e[o].classList.add("red"),this.receiveAttack(o,this.playerBoard,this.recordPlayerShipLocation),!0===this.playerWinCondition()?(console.log("player Win"),r=!0):!0===this.aiWinCondition()&&(console.log("ai Win"),r=!0)}}))}))}aiAimming(t,e){if(void 0===t)return;const i=this.getRow(t),r=this.getCol(t);if(console.log(t),0!==e[i][r]&&-1!==e[i][r]&&(this.otherAiAttack.length<1&&this.otherAiAttack.push(t),this.recordfirstAiAttack.length<1&&this.recordfirstAiAttack.push(t),this.recordAttackedShip.length<1))for(let t=0;t<this.recordPlayerShip.length;t++)this.playerBoard[i][r]===this.recordPlayerShip[t].shipLength&&this.recordAttackedShip.push(this.recordPlayerShip[t])}createUI(){const t=document.createElement("div");t.classList.add("container"),document.body.appendChild(t);const e=document.createElement("div");e.classList.add("header-container"),t.appendChild(e);const i=document.createElement("h1");i.classList.add("title"),i.textContent="BattleShip",e.appendChild(i);const r=document.createElement("div");r.classList.add("body-container"),t.appendChild(r);const a=document.createElement("div");a.classList.add("board-container","player-board"),r.appendChild(a);const s=document.createElement("div");s.classList.add("board-container","ai-board"),r.appendChild(s),s.classList.add("hide");const h=document.createElement("footer"),o=document.createElement("p");o.textContent="Create by Siraphop Sompamit",t.appendChild(h),h.appendChild(o),this.populateBoard(a),this.populateBoard(s)}populateBoard(t){for(let e=0;e<10;e++)for(let e=0;e<10;e++){const e=document.createElement("div");e.classList.add("cell"),t.classList.contains("player-board")?e.classList.add("player-cell"):e.classList.add("ai-cell"),t.appendChild(e)}}createShip(){const t=document.querySelector(".body-container"),e=document.createElement("div");e.classList.add("shiplist-container"),t.appendChild(e),this.populateShip(this.playerDestoryer,e),this.populateShip(this.playerAircraftCarrier,e),this.populateShip(this.playerCruiser,e),this.populateShip(this.playerBattleShip,e),this.recordAiShip.push(this.aiAircraftCarrier),this.recordAiShip.push(this.aiBattleShip),this.recordAiShip.push(this.aiCruiser),this.recordAiShip.push(this.aiDestoryer),this.recordAiShip.push(this.aiSubmarine)}populateShip(t,e){const i=document.createElement("div");i.classList.add("ship-container"),i.setAttribute("id",`ship${t.shipLength}-container`),i.style.gridTemplateColumns=`repeat(${t.shipLength}, 50px)`,e.appendChild(i),i.draggable=!0;for(let e=0;e<t.shipLength;e++){const e=document.createElement("div");e.classList.add("ship-cell"),this.colorFromLength(t.shipLength,e),e.setAttribute("id",`${t.shipLength}`),i.appendChild(e)}this.recordPlayerShip.push(t)}dragShip(){const t=document.querySelectorAll(".player-cell"),e=document.querySelectorAll(".ship-container"),i=document.querySelector(".shiplist-container"),r=document.querySelector(".ai-board");e.forEach((t=>{t.addEventListener("dragstart",(e=>{e.dataTransfer.setData("text/shipContainerID",t.id),e.dataTransfer.setData("text/shipCellRelativePos",e.offsetX)}))})),t.forEach(((e,a)=>{e.addEventListener("dragover",(t=>{t.preventDefault()})),e.addEventListener("drop",(e=>{const s=e.dataTransfer.getData("text/shipContainerID"),h=document.getElementById(s),o=h.querySelectorAll(".ship-cell"),l=parseInt(e.dataTransfer.getData("text/shipCellRelativePos"),10),n=Math.floor(l/50),d=a-n,c=this.getCol(d);if(!0===this.inSameRow(c,o.length,this.playerBoard)&&!0===this.isCellPlaced(d,o.length,this.playerBoard)){for(let e=d;e<d+o.length;e++)t[e].classList.add("placed"),this.colorFromLength(o.length,t[e]),h.remove();let e,i;this.pushShipLengthToArray(d,o,this.playerBoard,this.recordPlayerShip,this.recordPlayerShipLocation);do{e=Math.floor(100*Math.random()),i=this.getCol(e)}while(!1===this.inSameRow(i,o.length,this.aiBoard)||!1===this.isCellPlaced(e,o.length,this.aiBoard));this.pushShipLengthToArray(e,o,this.aiBoard,this.recordAiShip,this.recordAiShipLocation)}0===i.childElementCount&&(i.remove(),r.classList.remove("hide"))}))}))}pushShipLengthToArray(t,e,i,r,a){for(let s=0;s<r.length;s++)r[s].shipLength===e.length&&this.placeShip(t,r[s],i,a)}placeShip(t,e,i,r){if(t<0||null===t)return"Index cant be negative number or null";let a=this.getRow(t),s=this.getCol(t);if(a>i.length)return"Index is larger than the board";if(!0!==this.inSameRow(s,e.shipLength,i))return"out of bound";for(let h=0;h<e.shipLength;h++)i[a][s]=e.shipLength,s<=10?(r.push({shipLocation:t,ship:e}),t++,s++):(a++,s=0)}receiveAttack(t,e,i){let r=this.getRow(t),a=this.getCol(t);if(0===e[r][a]&&(e[r][a]=-1),0===e[r][a]||-1===e[r][a])return"Shot at the same locaiton";for(let e=0;e<i.length;e++)t===i[e].shipLocation&&i[e].ship.hits();e[r][a]=-1}isAllShipsSunk(t){return t.every((t=>"sunken ship"===t.shipLength))}playerWinCondition(){return this.isAllShipsSunk(this.recordAiShip)}aiWinCondition(){return this.isAllShipsSunk(this.recordPlayerShip)}inSameRow(t,e,i){return t+e<=i.length}isCellPlaced(t,e,i){const r=this.getRow(t),a=this.getCol(t);for(let t=a;t<a+e;t++)if(0!==i[r][t])return!1;return!0}getRow(t){return t>=100?Math.floor(t/10)-10:Math.floor(t/10)}getCol(t){return t%10}colorFromLength(t,e){2===t&&e.classList.add("midnightblue"),3===t&&e.classList.add("goldenrod"),4===t&&e.classList.add("darkviolet"),5===t&&e.classList.add("palevioletred"),6===t&&e.classList.add("chartreuse")}}(10,10)})();