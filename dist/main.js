(()=>{"use strict";class e{constructor(e){this.shipLength=e>=0?e:-1}hits(){this.shipLength=this.shipLength-1,this.isSunk()}isSunk(){0===this.shipLength&&(this.shipLength="sunken ship")}}class t{constructor(e){this.player=e}}new class{subMarine=new e(2);destroyer=new e(3);battleShip=new e(4);cruiser=new e(5);aircraftCarrier=new e(6);draggedShipElement=null;player=new t(!0);ai=new t(!1);recordShipCreate=[];recordShipLocation=[];constructor(e,t){this.playerBoard=this.createArrayboard(e),this.aiBoard=this.createArrayboard(t),this.createBoard(),this.createShip(),this.dragShip(),this.handleTurnClick()}createArrayboard(e){return Array.from({length:e},(()=>Array.from({length:e},(()=>0))))}handleTurnClick(){const e=document.querySelectorAll(".ai-cell"),t=document.querySelectorAll(".player-cell"),i=new Set;e.forEach(((e,a)=>{e.addEventListener("click",(()=>{if(!e.classList.contains("aquamarine")&&!e.classList.contains("red")){const r=this.getRow(a),s=this.getCol(a);let h;0===this.aiBoard[r][s]?e.classList.add("aquamarine"):e.classList.add("red"),this.receiveAttack(a,this.aiBoard);do{h=Math.floor(100*Math.random())}while(i.has(h)&&i.size<100);i.add(h);const o=this.getRow(h),l=this.getCol(h);0===this.playerBoard[o][l]?t[h].classList.add("aquamarine"):t[h].classList.add("red"),this.receiveAttack(h,this.playerBoard)}}))}))}createBoard(){const e=document.createElement("div");e.classList.add("container"),document.body.appendChild(e);const t=document.createElement("div");t.classList.add("board-container","player-board"),e.appendChild(t);const i=document.createElement("div");i.classList.add("board-container","ai-board"),e.appendChild(i),i.classList.add("hide"),this.populateBoard(t),this.populateBoard(i)}populateBoard(e){for(let t=0;t<10;t++)for(let t=0;t<10;t++){const t=document.createElement("div");t.classList.add("cell"),e.classList.contains("player-board")?t.classList.add("player-cell"):t.classList.add("ai-cell"),e.appendChild(t)}}createShip(){const e=document.querySelector(".container"),t=document.createElement("div");t.classList.add("shiplist-container"),e.appendChild(t),this.populateShip(this.subMarine,t),this.populateShip(this.destroyer,t),this.populateShip(this.aircraftCarrier,t),this.populateShip(this.cruiser,t),this.populateShip(this.battleShip,t)}populateShip(e,t){const i=document.createElement("div");i.classList.add("ship-container"),i.setAttribute("id",`ship${e.shipLength}-container`),i.style.gridTemplateColumns=`repeat(${e.shipLength}, 50px)`,t.appendChild(i),i.draggable=!0;for(let t=0;t<e.shipLength;t++){const t=document.createElement("div");t.classList.add("ship-cell"),this.colorFromLength(e.shipLength,t),t.setAttribute("id",`${e.shipLength}`),i.appendChild(t)}this.recordShipCreate.push(e)}dragShip(){const e=document.querySelectorAll(".player-cell"),t=document.querySelectorAll(".ship-container"),i=document.querySelector(".shiplist-container"),a=document.querySelector(".ai-board");t.forEach((e=>{e.addEventListener("dragstart",(t=>{t.dataTransfer.setData("text/shipContainerID",e.id),t.dataTransfer.setData("text/shipCellRelativePos",t.offsetX)}))})),e.forEach(((t,r)=>{t.addEventListener("dragover",(e=>{e.preventDefault()})),t.addEventListener("drop",(t=>{const s=t.dataTransfer.getData("text/shipContainerID"),h=document.getElementById(s),o=h.querySelectorAll(".ship-cell"),l=parseInt(t.dataTransfer.getData("text/shipCellRelativePos"),10),n=Math.floor(l/50),d=r-n,c=this.getCol(d);if(!0===this.inSameRow(c,o.length,this.playerBoard)&&!0===this.isCellPlaced(d,o.length,this.playerBoard)){for(let t=d;t<d+o.length;t++)e[t].classList.add("placed"),this.colorFromLength(o.length,e[t]),h.remove();let t,i;this.pushShipLengthToArray(d,o,this.playerBoard);do{t=Math.floor(100*Math.random()),i=this.getCol(t)}while(!1===this.inSameRow(i,o.length,this.aiBoard)||!1===this.isCellPlaced(t,o.length,this.aiBoard));this.pushShipLengthToArray(t,o,this.aiBoard)}0===i.childElementCount&&(i.remove(),a.classList.remove("hide"))}))}))}pushShipLengthToArray(e,t,i){for(let a=0;a<this.recordShipCreate.length;a++)this.recordShipCreate[a].shipLength===t.length&&this.placeShip(e,this.recordShipCreate[a],i)}placeShip(e,t,i){if(e<0||null===e)return"Index cant be negative number or null";let a=this.getRow(e),r=this.getCol(e);if(a>i.length)return"Index is larger than the board";if(!0!==this.inSameRow(r,t.shipLength,i))return"out of bound";for(let s=0;s<t.shipLength;s++)i[a][r]=t.shipLength,r<=10?(this.recordShipLocation.push({shipLocation:e,ship:t}),e++,r++):(a++,r=0)}receiveAttack(e,t){let i=this.getRow(e),a=this.getCol(e);if(-1===t[i][a])return"Shot at the same locaiton";for(let t=0;t<this.recordShipLocation.length;t++)e===this.recordShipLocation[t].shipLocation&&this.recordShipLocation[t].ship.hits();t[i][a]=-1}inSameRow(e,t,i){return e+t<=i.length}isCellPlaced(e,t,i){const a=this.getRow(e),r=this.getCol(e);for(let e=r;e<r+t;e++)if(0!==i[a][e])return!1;return!0}getRow(e){return e>=100?Math.floor(e/10)-10:Math.floor(e/10)}getCol(e){return e%10}isWithinBound(e,t){return e>-1&&e<11&&t>-1&&t<11}colorFromLength(e,t){2===e&&t.classList.add("midnightblue"),3===e&&t.classList.add("goldenrod"),4===e&&t.classList.add("darkviolet"),5===e&&t.classList.add("palevioletred"),6===e&&t.classList.add("chartreuse")}}(10,10)})();